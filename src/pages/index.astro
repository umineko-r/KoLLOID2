---
import BaseLayout from "../layouts/BaseLayout.astro";
import fs from "node:fs/promises";
import path from "node:path";

const title = "KoLLOID";
const subtitle = "とけない個のための表現空間";
const explanation = `この空間には様々な個性をもった表現がふわふわと浮遊しています。
ぜひ好きな粒子を手にとって眺めてみてください。`;

// ★ public/data/particles.json を読む（無くても壊れない）
const particlesPath = path.join(process.cwd(), "public", "data", "particles.json");

let totalCount = 0;

try {
  const raw = await fs.readFile(particlesPath, "utf-8");
  const parsed = JSON.parse(raw);
  totalCount = Array.isArray(parsed) ? parsed.length : 0;
} catch (e) {
  // 生成前/未配置などでもトップは表示したいので握りつぶす
  totalCount = 0;
}
---

<BaseLayout pageTitle={title} subtitle={subtitle} enableLinks={true}>
  <section>
    <h2 style="font-size: 1.4rem; margin-bottom: 0.5rem;">
      {subtitle}
    </h2>

    <p
      style="
        white-space: pre-line;
        margin-top: 1.5rem;
        font-size: 0.95rem;
        color: #333;
      "
    >
      {explanation}
    </p>

    {/* ★ 追加する一文（控えめに） */}
    <p
      style="
        margin-top: 1.2rem;
        font-size: 0.85rem;
        color: #777;
      "
    >
      現在、{totalCount}種類の粒子の中から、いくつかがランダムに浮かび上がっています。
    </p>
  </section>
</BaseLayout>